# Мониторинг деплоя в реальном времени

## Быстрый старт

### Вариант 1: GitHub Actions (автоматический деплой)

1. Перейдите в **GitHub → Actions**
2. Выберите нужный workflow run
3. Откройте job **deploy**
4. Все логи отображаются в реальном времени в интерфейсе GitHub

### Вариант 2: Локальный скрипт мониторинга (рекомендуется)

```bash
# Запустите скрипт
./monitor-deploy.sh
```

Выберите опцию из меню:
- **1** - Смотреть логи сборки в реальном времени
- **2** - Смотреть логи приложения в реальном времени  
- **3** - Разделенный экран (tmux) для обоих логов одновременно
- **4** - Мониторинг процессов (maven/java)
- **5** - Статус деплоя
- **6** - Последние 50 строк логов сборки
- **7** - Последние 50 строк логов приложения
- **8** - Интерактивная SSH сессия

### Вариант 3: Прямое подключение к серверу

```bash
# Подключитесь к серверу
ssh -i ~/.ssh/ocivm_key opc@130.162.224.203

# Смотрите логи сборки (новое расположение)
tail -f /home/opc/bewerbung-ai/build.log

# Смотрите логи приложения (проверяет оба места)
tail -f /home/opc/bewerbung-ai/app.log || tail -f /home/opc/app.log

# Проверить, где находится приложение
ps aux | grep bewerbung-ai-1.0.0.jar

# Или оба одновременно (в разных терминалах)
```

## Разделенный экран с tmux

Для одновременного просмотра обоих логов:

```bash
ssh -i ~/.ssh/ocivm_key opc@130.162.224.203

# Создать tmux сессию
tmux new -s deploy

# Разделить экран (Ctrl+B, затем %)
# Слева: tail -f /home/opc/bewerbung-ai/build.log
# Справа: tail -f /home/opc/bewerbung-ai/app.log

# Отключиться: Ctrl+B, затем D
# Подключиться обратно: tmux attach -t deploy
```

Или используйте скрипт мониторинга (опция 3) - он автоматически настроит tmux.

## Файлы логов на сервере

### Новое расположение (после деплоя через GitHub Actions):
- **`/home/opc/bewerbung-ai/build.log`** - Логи сборки Maven
- **`/home/opc/bewerbung-ai/app.log`** - Логи запущенного приложения
- **`/home/opc/bewerbung-ai/app.pid`** - PID файл процесса

### Старое расположение (если приложение запущено из `/opt/bewerbung-ai/`):
- **`/home/opc/app.log`** - Логи приложения (старое расположение)

**Примечание:** Если файлы логов не найдены, это означает, что:
- Деплой еще не запускался через GitHub Actions
- Или приложение запущено из старого расположения (`/opt/bewerbung-ai/`)

Используйте скрипт мониторинга (`./monitor-deploy.sh`) - он автоматически найдет логи в обоих местах.

## Полезные команды

```bash
# Статус приложения
ssh opc@130.162.224.203 "/home/opc/deploy.sh status"

# Последние 100 строк логов сборки (если есть)
ssh opc@130.162.224.203 "tail -100 /home/opc/bewerbung-ai/build.log 2>/dev/null || echo 'Build log not found'"

# Последние 100 строк логов приложения (проверяет оба места)
ssh opc@130.162.224.203 "if [ -f /home/opc/bewerbung-ai/app.log ]; then tail -100 /home/opc/bewerbung-ai/app.log; elif [ -f /home/opc/app.log ]; then tail -100 /home/opc/app.log; else echo 'App log not found'; fi"

# Или проще - используйте скрипт мониторинга
./monitor-deploy.sh
```

# Мониторинг процессов
ssh opc@130.162.224.203 "watch -n 1 'ps aux | grep -E \"maven|java\" | grep -v grep'"

# Использование памяти
ssh opc@130.162.224.203 "free -h"
```

## Во время GitHub Actions деплоя

Если деплой запущен через GitHub Actions, вы можете:

1. **Смотреть в GitHub Actions UI** - все логи отображаются там
2. **Подключиться к серверу** и смотреть логи в реальном времени:
   ```bash
   ssh -i ~/.ssh/ocivm_key opc@130.162.224.203
   tail -f /home/opc/bewerbung-ai/build.log
   ```
3. **Использовать скрипт мониторинга** - он покажет что происходит на сервере

## Troubleshooting

### Логи не обновляются

Убедитесь, что процесс еще работает:
```bash
ssh opc@130.162.224.203 "ps aux | grep maven"
ssh opc@130.162.224.203 "ps aux | grep bewerbung"
```

### Файл build.log не найден

Это нормально, если:
- Сборка еще не началась (файл создается во время сборки)
- Или сборка была выполнена вручную без сохранения логов

### Файл app.log не найден

Проверьте оба возможных расположения:
```bash
# Новое расположение (после GitHub Actions деплоя)
ls -la /home/opc/bewerbung-ai/app.log

# Старое расположение (если приложение из /opt/bewerbung-ai/)
ls -la /home/opc/app.log

# Или используйте скрипт мониторинга - он найдет автоматически
./monitor-deploy.sh
```

### Нужно остановить мониторинг

Нажмите **Ctrl+C** в терминале.

