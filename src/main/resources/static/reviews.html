<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bewertungen - Bewerbung AI</title>
    <script>
        window.tailwind = window.tailwind || {};
        window.tailwind.config = Object.assign(window.tailwind.config || {}, { darkMode: 'class' });
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Fallback dark theme styles if Tailwind doesn't apply */
        html.dark body,
        body.dark {
            background-color: #0f172a !important;
            color: #e2e8f0 !important;
        }
        html.dark .container,
        body.dark .container {
            background-color: #020617 !important;
            border-color: #1e293b !important;
        }
        html.dark h1,
        body.dark h1 {
            color: #e2e8f0 !important;
        }
        html.dark label,
        body.dark label {
            color: #e2e8f0 !important;
        }
        html.dark textarea,
        body.dark textarea {
            background-color: #0f172a !important;
            color: #e2e8f0 !important;
            border-color: #334155 !important;
        }
        html.dark a,
        body.dark a {
            background-color: #0f172a !important;
            border-color: #334155 !important;
            color: #e2e8f0 !important;
        }
        html.dark a:hover,
        body.dark a:hover {
            background-color: #1e293b !important;
        }
        html.dark p,
        body.dark p {
            color: #cbd5e1 !important;
        }

        /* Language selector styling */
        #languageSelector {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23666' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            padding-right: 2rem;
        }
    </style>
    <script>
        (function initThemeFromStorage() {
            const rootElement = document.documentElement;
            const bodyElement = document.body;
            const THEME_STORAGE_KEY = 'bewerbung-ai-theme';
            const THEME_VERSION_KEY = 'bewerbung-ai-theme-version';
            const THEME_VERSION = '2';

            function safeGetStoredValue(key) {
                try {
                    return localStorage.getItem(key);
                } catch (error) {
                    return null;
                }
            }

            function applyTheme(theme) {
                const isDark = theme === 'dark';
                rootElement.classList.toggle('dark', isDark);
                if (bodyElement) {
                    bodyElement.classList.toggle('dark', isDark);
                }
            }

            const storedTheme = safeGetStoredValue(THEME_STORAGE_KEY);
            const storedVersion = safeGetStoredValue(THEME_VERSION_KEY);
            
            if (storedVersion !== THEME_VERSION) {
                applyTheme('dark');
            } else if (storedTheme === 'dark' || storedTheme === 'light') {
                applyTheme(storedTheme);
            } else {
                applyTheme('dark');
            }
        })();
    </script>
</head>
<body class="min-h-screen bg-slate-50 text-slate-800 antialiased dark:bg-slate-900 dark:text-slate-100" style="font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;">
    <div class="container mx-auto max-w-3xl rounded-2xl bg-white px-6 py-8 shadow-sm ring-1 ring-slate-200 dark:bg-slate-950 dark:ring-slate-800 sm:px-10 sm:py-10">
        <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
            <h1 class="text-center text-2xl font-semibold tracking-tight text-slate-900 dark:text-slate-100 sm:text-left sm:text-3xl" data-i18n="reviewsTitle">Bewertungen</h1>
            <div class="flex items-center gap-2">
                <select id="languageSelector" class="inline-flex items-center justify-center rounded-xl border border-slate-200 bg-white px-3 py-2 text-xs font-semibold text-slate-700 shadow-sm transition-colors hover:bg-slate-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800 appearance-none pr-8 cursor-pointer">
                    <option value="de">DE</option>
                    <option value="ru">RU</option>
                    <option value="en">EN</option>
                </select>
                <a href="/" class="inline-flex items-center justify-center rounded-xl border border-slate-200 bg-white px-4 py-2 text-xs font-semibold text-slate-700 shadow-sm transition-colors hover:bg-slate-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800" data-i18n="backToHome">Zur Startseite</a>
            </div>
        </div>

        <p class="mt-5 text-sm text-slate-600 dark:text-slate-300" data-i18n="reviewPrompt">Ich wäre Ihnen dankbar, wenn Sie mir ein paar Zeilen mit Ihren Eindrücken zu diesem Service hinterlassen</p>

        <form id="reviewForm" class="mt-6 space-y-5" action="#" method="post" novalidate>
            <div class="space-y-2">
                <label for="reviewText" class="block text-sm font-medium text-slate-700 dark:text-slate-200" data-i18n="reviewLabel">Eigentliche Bewertung</label>
                <textarea id="reviewText" name="review" required class="min-h-[180px] w-full resize-y rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm text-slate-800 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 dark:focus:border-blue-400 dark:focus:ring-blue-900"></textarea>
                <p id="reviewError" class="hidden text-sm text-red-600 dark:text-red-300" data-i18n="reviewError">Bitte schreiben Sie eine Bewertung.</p>
            </div>

            <button type="submit" class="w-full rounded-xl bg-blue-600 px-6 py-3 text-sm font-semibold text-white shadow-sm transition-colors hover:bg-blue-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 dark:bg-blue-500 dark:hover:bg-blue-600" data-i18n="submitButton">Senden</button>
            <p id="reviewSuccess" class="hidden text-sm text-emerald-600 dark:text-emerald-300" data-i18n="reviewSuccess">Danke! Ihre Bewertung wurde gesendet.</p>
        </form>
    </div>

    <script>
        (function syncThemeUpdates() {
            const rootElement = document.documentElement;
            const bodyElement = document.body;
            const THEME_STORAGE_KEY = 'bewerbung-ai-theme';
            const THEME_VERSION_KEY = 'bewerbung-ai-theme-version';
            const THEME_VERSION = '2';

            function safeGetStoredValue(key) {
                try {
                    return localStorage.getItem(key);
                } catch (error) {
                    return null;
                }
            }

            function resolveTheme() {
                const storedTheme = safeGetStoredValue(THEME_STORAGE_KEY);
                const storedVersion = safeGetStoredValue(THEME_VERSION_KEY);
                if (storedVersion === THEME_VERSION && (storedTheme === 'dark' || storedTheme === 'light')) {
                    return storedTheme;
                }
                return 'dark';
            }

            function applyTheme(theme) {
                const isDark = theme === 'dark';
                rootElement.classList.toggle('dark', isDark);
                if (bodyElement) {
                    bodyElement.classList.toggle('dark', isDark);
                }
            }

            // Apply theme on load
            applyTheme(resolveTheme());

            // Listen for storage changes (when theme is changed on another tab/page)
            window.addEventListener('storage', (event) => {
                if (event.key === THEME_STORAGE_KEY || event.key === THEME_VERSION_KEY) {
                    applyTheme(resolveTheme());
                }
            });

            // Also check periodically in case storage event doesn't fire
            setInterval(() => {
                const currentTheme = resolveTheme();
                const isCurrentlyDark = rootElement.classList.contains('dark');
                if ((currentTheme === 'dark' && !isCurrentlyDark) || (currentTheme === 'light' && isCurrentlyDark)) {
                    applyTheme(currentTheme);
                }
            }, 100);
        })();

        // Language/i18n Management
        (function initLanguageSystem() {
            const LANGUAGE_STORAGE_KEY = 'bewerbung-ai-language';
            const translations = {
                de: {
                    reviewsTitle: 'Bewertungen',
                    backToHome: 'Zur Startseite',
                    reviewPrompt: 'Ich wäre Ihnen dankbar, wenn Sie mir ein paar Zeilen mit Ihren Eindrücken zu diesem Service hinterlassen',
                    reviewLabel: 'Bewertung',
                    reviewError: 'Bitte schreiben Sie eine Bewertung.',
                    submitButton: 'Senden',
                    reviewSuccess: 'Danke! Ihre Bewertung wurde gesendet.',
                    reviewErrorSubmit: 'Senden fehlgeschlagen. Bitte versuchen Sie es erneut.'
                },
                ru: {
                    reviewsTitle: 'Отзывы',
                    backToHome: 'На главную',
                    reviewPrompt: 'Буду благодарен, если вы оставите несколько строк с вашими впечатлениями об этом сервисе',
                    reviewLabel: 'Отзыв',
                    reviewError: 'Пожалуйста, напишите отзыв.',
                    submitButton: 'Отправить',
                    reviewSuccess: 'Спасибо! Ваш отзыв был отправлен.',
                    reviewErrorSubmit: 'Отправка не удалась. Пожалуйста, попробуйте еще раз.'
                },
                en: {
                    reviewsTitle: 'Reviews',
                    backToHome: 'Back to Home',
                    reviewPrompt: 'I would be grateful if you could leave a few lines with your impressions of this service',
                    reviewLabel: 'Review',
                    reviewError: 'Please write a review.',
                    submitButton: 'Submit',
                    reviewSuccess: 'Thank you! Your review has been sent.',
                    reviewErrorSubmit: 'Submission failed. Please try again.'
                }
            };

            function safeGetStoredValue(key) {
                try {
                    return localStorage.getItem(key);
                } catch (error) {
                    return null;
                }
            }

            function safeStoreValue(key, value) {
                try {
                    localStorage.setItem(key, value);
                } catch (error) {
                    // Storage can be blocked on some mobile browsers; ignore silently.
                }
            }

            function getCurrentLanguage() {
                const stored = safeGetStoredValue(LANGUAGE_STORAGE_KEY);
                return (stored && (stored === 'de' || stored === 'ru' || stored === 'en')) ? stored : 'de';
            }

            function translate(key, lang) {
                const langData = translations[lang] || translations.de;
                return langData[key] || key;
            }

            function applyTranslations(lang) {
                const elements = document.querySelectorAll('[data-i18n]');
                elements.forEach(element => {
                    const key = element.getAttribute('data-i18n');
                    const text = translate(key, lang);
                    if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                        element.placeholder = text;
                    } else {
                        element.textContent = text;
                    }
                });
            }

            // Initialize language selector
            const languageSelector = document.getElementById('languageSelector');
            if (languageSelector) {
                const currentLang = getCurrentLanguage();
                languageSelector.value = currentLang;
                applyTranslations(currentLang);

                languageSelector.addEventListener('change', (e) => {
                    const newLang = e.target.value;
                    safeStoreValue(LANGUAGE_STORAGE_KEY, newLang);
                    applyTranslations(newLang);
                });
            }

            // Export translation function for use in other scripts
            window.i18n = {
                translate: (key) => translate(key, getCurrentLanguage()),
                getCurrentLanguage: getCurrentLanguage
            };
        })();

        const reviewForm = document.getElementById('reviewForm');
        const reviewText = document.getElementById('reviewText');
        const reviewError = document.getElementById('reviewError');
        const reviewSuccess = document.getElementById('reviewSuccess');

        reviewForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            const trimmedReview = reviewText.value.trim();
            if (!trimmedReview) {
                reviewError.textContent = window.i18n ? window.i18n.translate('reviewError') : 'Bitte schreiben Sie eine Bewertung.';
                reviewError.classList.remove('hidden');
                reviewSuccess.classList.add('hidden');
                reviewText.focus();
                return;
            }

            reviewError.classList.add('hidden');
            reviewSuccess.classList.add('hidden');

            const payload = {
                review: trimmedReview
            };

            try {
                const response = await fetch('/api/reviews', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error('Request failed');
                }

                reviewSuccess.classList.remove('hidden');
                reviewForm.reset();
            } catch (error) {
                reviewError.textContent = window.i18n ? window.i18n.translate('reviewErrorSubmit') : 'Senden fehlgeschlagen. Bitte versuchen Sie es erneut.';
                reviewError.classList.remove('hidden');
            }
        });
    </script>
</body>
</html>

